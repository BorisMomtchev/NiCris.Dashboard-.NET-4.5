@{
    ViewBag.Title = "BizMsgMonitor";
}

  <script type="text/javascript">
  $(function () {
      // Proxy created on the fly
      var bizMsgConn = $.connection.chat;
      
      // Only from server
      bizMsgConn.addMessageEx = function (bizMsgEx) {
          // Parse to json object
          var bizMsgExObj = JSON.parse(bizMsgEx);

          // Prep the li element
          var $res = $("<li />").css("display", "none");
          $res.append(bizMsgExObj.EntityValue + " -- " + bizMsgExObj.EntityStatus  + " -- " + bizMsgExObj.User + " -- " + new Date(bizMsgExObj.Date).toUTCString());
          $res.addClass("regularitem");
          $res.appendTo($('#messagesEx')).slideDown();

          // slideUp & remove from DOM logic
          if ($("#messagesEx li").size() > 7) {
              $('#messagesEx li').first().next().slideUp();
              $('#messagesEx li').first().remove();
          }
      };

      $('#msgExFlow').show();

      // Start the connection
      $.connection.hub.start();
  });
  </script>


<div class="page-header">
  <h1><small>Live Biz Stream</small></h1>
</div>

<table><tr>
    <td style="vertical-align:top">
        @* Control Panel *@
        <div class="btn-group btn-group-vertical">
            <button class="btn" id="pause"><i class="icon-pause icon-black"></i></button>
            <button class="btn" id="step-backward"><i class="icon-step-backward icon-black"></i></button>
            <button class="btn" id="step-forward"><i class="icon-step-forward icon-black"></i></button>
            <button class="btn" id="play"><i class="icon-play icon-black"></i></button>
        </div>
    </td>
    <td>
        @* Business Stream *@
        <div id="page">
            <span id="msgExFlow">
                <ul id="messagesEx" class="ticker"></ul>
            </span>
        </div>
    </td>
</tr></table>

<style>
    #page {
	    width: 900px;
	    margin: 0 auto;
	    margin-bottom: 50px;
    } 

    .ticker {
	    width: 850px;
    }

    .ticker li {
	    height: 40px;
	    border-bottom: 1px dotted #DDD;
	    padding: 5px;
	    margin: 0px 5px;
        font-size: larger;
        font-weight: bold;
	    box-shadow: 0px 0px 5px #DDD;
    }

    #messagesEx {
	    height: 300px;
    }

    #messagesEx li {
	    height: 40px;
	    overflow: hidden;
    }

    .regularitem {
        list-style: none outside none;
        margin: 10px;
        padding: 10px;
        width: 850px;

        background-image: linear-gradient(left top, rgb(245,37,172) 17%, rgb(152,71,222) 59%);
        background-image: -o-linear-gradient(left top, rgb(245,37,172) 17%, rgb(152,71,222) 59%);
        background-image: -moz-linear-gradient(left top, rgb(245,37,172) 17%, rgb(152,71,222) 59%);
        background-image: -webkit-linear-gradient(left top, rgb(245,37,172) 17%, rgb(152,71,222) 59%);
        background-image: -ms-linear-gradient(left top, rgb(245,37,172) 17%, rgb(152,71,222) 59%);

        background-image: -webkit-gradient(
          linear,
          left top,
          right bottom,
          color-stop(0.17, rgb(245,37,172)),
          color-stop(0.59, rgb(152,71,222))
        );

        -webkit-border-radius: 10px;
        -moz-border-radius: 15px;
        border-radius: 15px;
    }
</style>

@*https://github.com/SignalR/SignalR/wiki/QuickStart-Hubs*@