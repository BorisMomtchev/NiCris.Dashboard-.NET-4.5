@{
    ViewBag.Title = "Chat";
}

<h2>Chat</h2>

  <script src="~/Scripts/jquery-1.8.0.min.js" type="text/javascript"></script>
  <script src="~/Scripts/jquery.signalR-0.5.3.min.js" type="text/javascript"></script>
  <script src="/signalr/hubs" type="text/javascript"></script>

  <script type="text/javascript">
  $(function () {
      // Proxy created on the fly
      var chat = $.connection.chat;
      
      // Declare a function on the chat hub so the server can invoke it
      chat.addMessage = function(message) {
          $('#messages').append('<li>' + message + '</li>');
      };
      
      $("#broadcast").click(function () {
          // Call the chat method on the server
          chat.send($('#msg').val());
      });
      
      // Only from server
      var counter = 0;
      chat.addMessageEx = function (message) {
          var $res = $("<li />");
          $res.append(message);
          $res.appendTo($('#messagesEx'));

          if (counter > 5) {
              $('#messagesEx li').eq(counter - 6).slideUp();
          }
          // $('#messagesEx li:first').slideUp(function () { $(this).appendTo($('#messagesEx')).slideDown(); });
          counter++;
      };
      $('#msgExFlow').show();

      // Start the connection
      $.connection.hub.start();
  });
  </script>
  
  <input type="text" id="msg" />
  <input type="button" id="broadcast" value="broadcast" />

   @* Chat *@ 
    <ul id="messages"></ul>
    <hr/>

  @* Business Stream *@
    <div id="page">
        <span id="msgExFlow">
            <h2>Live Business Stream</h2>
            <ul id="messagesEx" class="ticker"></ul>
        </span>
    </div>


<style>

    #page {
	    width: 640px;
	    margin: 0 auto;
	    background-color: #FFF;
	    margin-bottom: 50px;
    } 

    .ticker {
	    width: 640px;
	    height: 120px;
	    overflow: hidden;
	    border: 1px solid #DDD;
	    margin: 0;
	    padding: 0;
	    list-style: none;
	    border-radius: 5px;
	    box-shadow: 0px 0px 5px #DDD;
    }

    .ticker li {
	    height: 30px;
	    border-bottom: 1px dotted #DDD;
	    padding: 5px;
	    margin: 0px 5px;
        font-size:larger;
        font-weight:bold;
	    box-shadow: 0px 0px 5px #DDD;
    }

    #messagesEx {
	    height: 300px;
    }

    #messagesEx li {
	    height: 40px;
	    overflow: hidden;
    }
</style>

@*https://github.com/SignalR/SignalR/wiki/QuickStart-Hubs*@